<!DOCTYPE html>
<html lang="en">
<head>
  <title>Mysql Task- hiddenbrains</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

</head>
<body>
	<div class="container">
 <div class="row">
    <div class="col-sm-12">
      <h3>Write function that sort 2D Array on particular Key & reset array seq.</h3>
     <h4>Table dump</h4>
     <pre>
     	-- Adminer 4.2.5 MySQL dump

SET NAMES utf8;
SET time_zone = '+00:00';
SET foreign_key_checks = 0;
SET sql_mode = 'NO_AUTO_VALUE_ON_ZERO';

SET NAMES utf8mb4;

DROP TABLE IF EXISTS `orders`;
CREATE TABLE `orders` (
  `order_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `order_date` date NOT NULL,
  `created` datetime NOT NULL,
  `modified` datetime NOT NULL,
  PRIMARY KEY (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `orders` (`order_id`, `user_id`, `order_date`, `created`, `modified`) VALUES
(1,	1,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(2,	1,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(3,	1,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(4,	2,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(6,	2,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(7,	2,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(8,	2,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(9,	3,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(13,	3,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(14,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(15,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(16,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(17,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(18,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(19,	5,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(20,	6,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(28,	7,	'2020-08-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(29,	7,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(30,	7,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(31,	8,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(32,	8,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(33,	8,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(34,	8,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(35,	8,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(36,	9,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(37,	10,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(38,	10,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(39,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(40,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(41,	4,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(42,	5,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00'),
(43,	6,	'2020-09-04',	'2020-09-04 00:17:47',	'0000-00-00 00:00:00');

DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
  `user_id` int(11) NOT NULL AUTO_INCREMENT,
  `firstname` varchar(255) NOT NULL,
  `lastname` varchar(255) NOT NULL,
  `gender` enum('Male','Female') NOT NULL,
  `status` enum('Active','Inactive') NOT NULL DEFAULT 'Active',
  `hobby` text NOT NULL,
  `created` datetime NOT NULL,
  `modified` datetime NOT NULL,
  PRIMARY KEY (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `users` (`user_id`, `firstname`, `lastname`, `gender`, `status`, `hobby`, `created`, `modified`) VALUES
(1,	'Jhon',	'Deo',	'Male',	'Active',	'baseball',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(2,	'Ruben',	'Tyson',	'Male',	'Active',	'cricket,snooker',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(3,	'Julia',	'Wilson',	'Female',	'Active',	'snooker',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(4,	'Rick',	'P',	'Male',	'Active',	'socker',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(5,	'Shane',	'W',	'Male',	'Active',	'baseball',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(6,	'Stuart',	'Little',	'Male',	'Active',	'baseball',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(7,	'George',	'Hamburg',	'Male',	'Active',	'cricket,batminton',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(8,	'Smit',	'Joe',	'Male',	'Active',	'baseball,cricket',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(9,	'Peter',	'J',	'Male',	'Active',	'cricket,hockey',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00'),
(10,	'Rob',	'Wisily',	'Male',	'Active',	'baseball',	'2020-09-04 00:11:08',	'0000-00-00 00:00:00');

-- 2020-09-03 19:38:16
     </pre>
      Query -
      <h5>1) You need to write a query that returns all users with the total order count of that user.</h5>
      <pre>
        select u.*,count(o.user_id) as total_orders from users u 
        left join orders o on o.user_id=u.user_id
        group by u.user_id
        order by u.firstname;

      </pre>

      <h5>2) You need to write query that return only those users which hobby is "cricket, and that user placed minimum 3 orders in current month</h5>
      <pre>
        select u.* ,count(o.user_id) as total_orders
        from users u 
        left join orders o on o.user_id=u.user_id
        where  FIND_IN_SET ("cricket",u.hobby) and MONTH(o.order_date) = MONTH(CURRENT_DATE())
        group by u.user_id
        having total_orders >= 3
        order by u.firstname;
      </pre>

    </div>
  </div>
  </div>
</body>
</html>
